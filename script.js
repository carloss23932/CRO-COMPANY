// قاموس الترجمة - يحتوي على جميع النصوص العربية والإنجليزية
const translations = {
    'en': {
        // العناوين العامة والتنقل
        pageTitle: 'CRO - App Development',
        navAbout: 'About Us',
        navPortfolio: 'Our Apps',
        navUpdates: 'Updates',
        navContact: 'Contact',
        heroHeading: 'Android Innovators: Turning Your Ideas into Outstanding Digital Applications.',
        heroText: 'Specialized solutions in Android app development and professional user interface design.',
        heroCTA: 'Start Your Project Now',
        
        // قسم من نحن والخدمات
        aboutHeading: 'Who We Are?',
        aboutText: 'At **CRO**, we are a specialized team of developers and UI/UX designers passionate about creating innovative Android applications and exceptional user interfaces. Our mission is to help businesses reach millions of Android users through high-performance apps and attractive designs.',
        servicesHeading: 'Our Core Services',
        service1Title: 'Android App Development',
        service1Text: 'Building innovative and high-performance Android applications using the latest technologies like Kotlin and Java. Apps compatible with all Android versions.',
        service2Title: 'User Interface/Experience Design (UI/UX)',
        service2Text: 'We design modern and attractive user interfaces following the latest Material Design standards. Smooth and enjoyable user experience that ensures customer retention.',
        service3Title: 'App Development & Enhancement',
        service3Text: 'We analyze and improve existing applications, enhance performance and add new features. Specialized consulting services.',
        
        // قسم التطبيقات (Portfolio)
        portfolioHeading: 'Our Published Apps',
        portfolioSubText: 'Here are some of our outstanding projects that have made a difference in the market.',
        
        // التطبيق الأول - Morse Converter
        app1Title: 'Morse Converter - Code Translator',
        app1Desc: 'Simple and practical Android app that allows you to convert text to Morse code and vice versa quickly and easily. Full support for English alphabet and numbers with easy-to-use interface.',
        app1CTA: 'Download Now',

        // التطبيق الثاني
        app2Title: 'TaskPro Android',
        app2Desc: 'Advanced Android task management app with intelligent user interface. Features AI capabilities and instant synchronization. Increased client productivity by 50%.',
        app2CTA: 'Download Now',
        
        // التطبيق الثالث
        app3Title: 'UI Showcase - Interface Gallery',
        app3Desc: 'Android app showcasing our latest UI/UX designs. Innovative interfaces following Material Design 3 with advanced interactive effects.',
        app3CTA: 'Visit Gallery',
        
        // قسم الأخبار (Updates)
        updatesHeading: 'Latest News and Posts',
        post1Title: 'New Partnership with Saudi Bank',
        post1Desc: 'We are delighted to announce our strategic collaboration to develop the pioneering FinTech Pro app in the financial technology sector.',
        post1Link: 'Read More',
        post2Title: 'Launching the New AI Assistant Feature',
        post2Desc: 'We have updated the TaskManager Pro app by adding the long-awaited AI Assistant feature to greatly enhance user experience.',
        post2Link: 'Read More',
        
        // قسم التواصل (Contact)
        contactHeading: 'Contact Us',
        contactLead: 'Our team is waiting for you! Get in touch today to turn your idea into reality. Send us a message or contact us via the details below.',
        contactPhoneLabel: 'Phone',
        contactPhoneDesc: 'For direct contact and instant inquiry',
        directCallBtn: 'Direct Call',
        whatsappBtn: 'WhatsApp',
        contactFormTitle: 'Send Us a Message',
        sendBtn: 'Send Message',
        
        // الخدمات في النموذج
        serviceDefault: 'Choose Required Service',
        serviceAndroid: 'Android App Development',
        serviceUiux: 'UI/UX Design',
        serviceImprovement: 'App Development & Enhancement',
        serviceConsultation: 'Technical Consultation',
        
        // نصوص الـ placeholders
        namePlaceholder: 'Full Name',
        emailPlaceholder: 'Your Email Address',
        phonePlaceholder: 'Phone Number',
        messagePlaceholder: 'Write your message here...',
        
        // أزرار الفيديو والتحميل
        watchReviewBtn: 'Watch Review',
        downloadFromPlayBtn: 'Download from Google Play',
        
        // MyTools Coming Soon Section
        upcomingHeading: 'Coming Soon App',
        upcomingSubText: "We're working on an amazing new app that will change how you use tools on your phone!",
        mytoolsTitle: 'MyTools - Smart Tools Collection',
        mytoolsDesc: 'A comprehensive app that brings together the most important digital tools in one place. From creating QR codes to converting video to audio, from color picking to converting images to PDF and audio recording - everything you need in one app with a modern and easy-to-use design.',
        comingSoonText: 'Under development... Coming soon!',
        notifyText: 'Want to be notified when it launches?',
        notifyBtn: 'Notify me on launch',
        
        // MyTools Features
        feature1Text: 'Smart QR Code Generator',
        feature2Text: 'Video to Audio Converter',
        feature3Text: 'Advanced Color Picker',
        feature4Text: 'Image to PDF Converter',
        feature5Text: 'Professional Audio Recorder',
        feature6Text: 'More coming soon...',
        
        // التذييل
        footerServicesTitle: 'Our Services',
        footerContactTitle: 'Contact Us',
        footerServiceAndroid: 'Android Development',
        footerServiceUiux: 'UI/UX Design',
        footerServiceImprovement: 'App Enhancement',
        footerText: '© 2024. CRO. All rights reserved.'
    },
    'ar': {
        // العناوين العامة والتنقل
        pageTitle: 'CRO - تطوير التطبيقات',
        navAbout: 'من نحن',
        navPortfolio: 'تطبيقاتنا',
        navUpdates: 'الأخبار',
        navContact: 'اتصل بنا',
        heroHeading: 'مبدعون في تطوير أندرويد: نحول أفكارك إلى تطبيقات رقمية متميزة.',
        heroText: 'حلول متخصصة في تطوير تطبيقات أندرويد وتصميم واجهات مستخدم احترافية.',
        heroCTA: 'ابدأ مشروعك الآن',
        
        // قسم من نحن والخدمات
        aboutHeading: 'من نحن؟',
        aboutText: 'نحن في **سي آر أو**، فريق متخصص من المطورين ومصممي الواجهات الشغوفين بإنشاء تطبيقات أندرويد مبتكرة وواجهات مستخدم استثنائية. رسالتنا هي تمكين الشركات من الوصول إلى ملايين مستخدمي أندرويد عبر تطبيقات عالية الأداء وتصميمات جذابة.',
        servicesHeading: 'خدماتنا الأساسية',
        service1Title: 'تطوير تطبيقات أندرويد',
        service1Text: 'بناء تطبيقات أندرويد مبتكرة وعالية الأداء باستخدام أحدث التقنيات مثل كوتلن و جافا. تطبيقات متوافقة مع جميع إصدارات أندرويد.',
        service2Title: 'تصميم واجهات المستخدم',
        service2Text: 'نصمم واجهات مستخدم حديثة وجذابة تتبع أحدث معايير التصميم العصري. تجربة مستخدم سلسة وممتعة تضمن عودة العملاء.',
        service3Title: 'تطوير وتحسين التطبيقات',
        service3Text: 'نقوم بتحليل وتحسين التطبيقات القائمة، ورفع مستوى الأداء وإضافة ميزات جديدة. خدمات استشارية متخصصة.',
        
        // قسم التطبيقات (Portfolio)
        portfolioHeading: 'تطبيقاتنا المنشورة',
        portfolioSubText: 'إليك بعض من أبرز مشاريعنا التي أحدثت فرقًا في السوق.',
        
        // التطبيق الأول - Morse Converter
        app1Title: 'محول مورس - محول الشفرة',
        app1Desc: 'تطبيق أندرويد عملي وبسيط يتيح لك تحويل النص إلى شفرة مورس والعكس بسرعة وسهولة. يدعم الأبجدية الإنجليزية والأرقام بالكامل مع واجهة سهلة الاستخدام.',
        app1CTA: 'حمله الآن',

        // التطبيق الثاني
        app2Title: 'تاسك برو أندرويد',
        app2Desc: 'تطبيق أندرويد متطور لإدارة المهام مع واجهة مستخدم ذكية. يتضمن ميزات الذكاء الاصطناعي والمزامنة الفورية. زاد إنتاجية العملاء بنسبة 50%.',
        app2CTA: 'حمله الآن',
        
        // التطبيق الثالث
        app3Title: 'معرض الواجهات - معرض التصاميم',
        app3Desc: 'تطبيق أندرويد يعرض أحدث تصميمات واجهات المستخدم التي قمنا بإنشائها. واجهات مبتكرة تتبع أحدث معايير التصميم مع تأثيرات تفاعلية متطورة.',
        app3CTA: 'زيارة المعرض',
        
        // قسم الأخبار (Updates)
        updatesHeading: 'آخر الأخبار والمنشورات',
        post1Title: 'شراكة جديدة مع البنك السعودي',
        post1Desc: 'سعداء بالإعلان عن تعاوننا الاستراتيجي لتطوير تطبيق فين-تك برو الرائد في مجال التكنولوجيا المالية.',
        post1Link: 'اقرأ المزيد',
        post2Title: 'إطلاق ميزة المساعد الذكي الجديدة',
        post2Desc: 'قمنا بتحديث تطبيق مدير المهام برو بإضافة ميزة المساعد الذكي التي طال انتظارها، لتعزيز تجربة المستخدم بشكل كبير.',
        post2Link: 'اقرأ المزيد',
        
        // قسم التواصل (Contact)
        contactHeading: 'اتصل بنا',
        contactLead: 'فريقنا ينتظرك! تواصل معنا اليوم لتحويل فكرتك إلى واقع. أرسل لنا رسالة أو تواصل عبر البيانات أدناه.',
        contactPhoneLabel: 'الهاتف',
        contactPhoneDesc: 'للاتصال المباشر والاستفسار الفوري',
        directCallBtn: 'اتصال مباشر',
        whatsappBtn: 'WhatsApp',
        contactFormTitle: 'أرسل لنا رسالة',
        sendBtn: 'إرسال الرسالة',
        
        // الخدمات في النموذج
        serviceDefault: 'اختر الخدمة المطلوبة',
        serviceAndroid: 'تطوير تطبيقات أندرويد',
        serviceUiux: 'تصميم واجهات المستخدم',
        serviceImprovement: 'تطوير وتحسين التطبيقات',
        serviceConsultation: 'استشارة تقنية',
        
        // نصوص الـ placeholders
        namePlaceholder: 'الاسم الكامل',
        emailPlaceholder: 'بريدك الإلكتروني',
        phonePlaceholder: 'رقم الهاتف',
        messagePlaceholder: 'اكتب رسالتك هنا...',
        
        // أزرار الفيديو والتحميل
        watchReviewBtn: 'مشاهدة المراجعة',
        downloadFromPlayBtn: 'تحميل من Google Play',
        
        // MyTools Coming Soon Section
        upcomingHeading: 'تطبيق قادم',
        upcomingSubText: 'نحن نعمل على تطوير تطبيق جديد رائع سيغير طريقة استخدام الأدوات على هاتفك!',
        mytoolsTitle: 'MyTools - مجموعة الأدوات الذكية',
        mytoolsDesc: 'تطبيق شامل يجمع أهم الأدوات الرقمية في مكان واحد. من إنشاء رموز QR إلى تحويل الفيديو للصوت، ومن انتقاء الألوان إلى تحويل الصور لـPDF وتسجيل الصوت - كل ما تحتاجه في تطبيق واحد بتصميم عصري وسهل الاستخدام.',
        comingSoonText: 'قيد التطوير... سيتم إطلاقه قريباً!',
        notifyText: 'أريد إشعاراً عند الإطلاق؟',
        notifyBtn: 'أعلمني عند الإطلاق',
        
        // MyTools Features
        feature1Text: 'مولد رموز QR ذكي',
        feature2Text: 'محول الفيديو إلى صوت',
        feature3Text: 'منتقي الألوان المتقدم',
        feature4Text: 'تحويل الصور إلى PDF',
        feature5Text: 'مسجل صوتي احترافي',
        feature6Text: 'والمزيد قريباً...',
        
        // التذييل
        footerServicesTitle: 'خدماتنا',
        footerContactTitle: 'تواصل معنا',
        footerServiceAndroid: 'تطوير أندرويد',
        footerServiceUiux: 'تصميم واجهات المستخدم',
        footerServiceImprovement: 'تحسين التطبيقات',
        footerText: '© 2024. CRO. جميع الحقوق محفوظة.'
    }
};

// ثوابت الاتصال العامة
const COMPANY_PHONE = '+964 780 099 9387';
const COMPANY_PHONE_TEL = '+9647800999387';

// مفاتيح ترجمة لرسائل الحالة
translations.en = {
    ...translations.en,
    sendSuccessTitle: 'Your message has been sent!',
    sendSuccessDesc: 'We received your message. Our team will contact you soon.',
    sendMailtoOpenedTitle: 'Your email app was opened to send your message.',
    sendMailtoFinalStepTitle: 'Final step:',
    sendMailtoFinalStepText: 'Click "Send" in your email app to actually send.',
    whatsappHint: 'Or contact us directly via WhatsApp.',
    quickPhone: 'Quick phone contact:',
    requiredFields: 'Please fill in all required fields.',
    sendingAuto: 'Sending...',
    callUnsupportedTitle: "Direct calling isn't supported on this device.",
    callNumberCopied: 'The phone number has been copied to your clipboard.',
    callManualDial: 'Please dial:'
};

translations.ar = {
    ...translations.ar,
    sendSuccessTitle: 'تم إرسال رسالتك!',
    sendSuccessDesc: 'استلمنا رسالتك. سنتواصل معك قريباً.',
    sendMailtoOpenedTitle: 'تم فتح تطبيق البريد لإرسال رسالتك.',
    sendMailtoFinalStepTitle: 'خطوة أخيرة:',
    sendMailtoFinalStepText: 'اضغط "إرسال/Send" في تطبيق البريد لإرسال الرسالة فعلياً.',
    whatsappHint: 'أو تواصل معنا مباشرة عبر واتساب.',
    quickPhone: 'للتواصل السريع عبر الهاتف:',
    requiredFields: 'يرجى تعبئة جميع الحقول المطلوبة.',
    sendingAuto: 'جارٍ الإرسال...',
    callUnsupportedTitle: 'الاتصال الفوري غير مدعوم على هذا الجهاز.',
    callNumberCopied: 'تم نسخ رقم الهاتف إلى الحافظة.',
    callManualDial: 'يرجى الاتصال بالرقم:'
};

// جلب اللغة الحالية
function getCurrentLang() {
    return localStorage.getItem('preferredLanguage') || document.documentElement.getAttribute('lang') || 'ar';
}

function setLanguage(lang) {
    // 1. تبديل النصوص
    const currentTrans = translations[lang];
    for (const key in currentTrans) {
        const element = document.getElementById(key);
        if (element) {
            // استخدام innerHTML للحفاظ على تنسيق Bold في بعض النصوص
            element.innerHTML = currentTrans[key]; 
        }
    }

    // 2. تبديل placeholders للحقول
    const placeholderElements = document.querySelectorAll('[data-placeholder-key]');
    placeholderElements.forEach(element => {
        const placeholderKey = element.getAttribute('data-placeholder-key');
        if (currentTrans[placeholderKey]) {
            element.setAttribute('placeholder', currentTrans[placeholderKey]);
        }
    });

    // 3. تبديل الاتجاه (Direction) والـ lang attribute
    const htmlElement = document.documentElement;
    if (lang === 'ar') {
        htmlElement.setAttribute('lang', 'ar');
        htmlElement.setAttribute('dir', 'rtl');
    } else {
        htmlElement.setAttribute('lang', 'en');
        htmlElement.setAttribute('dir', 'ltr');
    }

    // 4. تبديل حالة الأزرار
    document.getElementById('langAr').classList.remove('active');
    document.getElementById('langEn').classList.remove('active');
    document.getElementById('lang' + (lang === 'ar' ? 'Ar' : 'En')).classList.add('active');
}

// كشف الجهاز المحمول
function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Windows Phone/i.test(navigator.userAgent);
}

// نسخ إلى الحافظة
async function copyToClipboard(text) {
    try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            await navigator.clipboard.writeText(text);
            return true;
        }
    } catch (_) {}
    // fallback
    const input = document.createElement('input');
    input.value = text;
    document.body.appendChild(input);
    input.select();
    input.setSelectionRange(0, text.length);
    try { document.execCommand('copy'); } catch (_) {}
    document.body.removeChild(input);
    return true;
}

// تهيئة زر الاتصال المباشر
function setupDirectCallButton() {
    const link = document.getElementById('directCallLink');
    if (!link) return;
    const tel = link.getAttribute('data-phone-tel') || COMPANY_PHONE_TEL;
    const display = link.getAttribute('data-phone-display') || COMPANY_PHONE;
    // تأكيد ضبط href
    link.setAttribute('href', `tel:${tel}`);

    link.addEventListener('click', async function (e) {
        const lang = getCurrentLang();
        const t = translations[lang] || translations['ar'];
        if (!isMobileDevice()) {
            e.preventDefault();
            await copyToClipboard(display);
            const statusEl = document.getElementById('formStatus');
            if (statusEl) {
                statusEl.innerHTML = `📞 <strong>${t.callUnsupportedTitle}</strong><br><small>${t.callNumberCopied}</small><br><small>${t.callManualDial} <a href="tel:${tel}">${display}</a></small>`;
                statusEl.classList.add('show', 'success');
            } else {
                alert(`${t.callUnsupportedTitle}\n${t.callNumberCopied}\n${t.callManualDial} ${display}`);
            }
        } else {
            // على الأجهزة المدعومة، اترك المتصفح يتابع الرابط tel:
        }
    });
}

// دوال مساعدة للتحقق من توفر الخادم
function checkServerAvailability() {
    return fetch('http://localhost:3000/api/contact', {
        method: 'HEAD',
        timeout: 2000
    })
    .then(() => true)
    .catch(() => false);
}

// دالة إرسال عبر mailto كبديل
function sendViaMailto(formData) {
    const serviceNames = {
        android: 'تطوير تطبيقات أندرويد',
        uiux: 'تصميم واجهات المستخدم',
        improvement: 'تطوير وتحسين التطبيقات',
        consultation: 'استشارة تقنية'
    };
    
    const serviceName = serviceNames[formData.service] || formData.service;
    const subject = `رسالة جديدة من ${formData.name} - ${serviceName}`;
    
    const body = `مرحبا،

الاسم: ${formData.name}
البريد الإلكتروني: ${formData.email}
الهاتف: ${formData.phone || 'غير محدد'}
الخدمة المطلوبة: ${serviceName}

الرسالة:
${formData.message}

---
تم الإرسال عبر موقع CRO`;
    
    const mailtoLink = `mailto:nkslssk1987@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    window.open(mailtoLink, '_blank');
}

// إضافة وظائف جديدة
// إعداد EmailJS
function initializeEmailJS() {
    emailjs.init("YOUR_PUBLIC_KEY"); // سيتم استبداله بالمفتاح الحقيقي
}

// إرسال بريد تلقائي باستخدام EmailJS
function sendEmailDirectly(formData) {
    const serviceNames = {
        android: 'تطوير تطبيقات أندرويد',
        uiux: 'تصميم واجهات المستخدم',
        improvement: 'تطوير وتحسين التطبيقات',
        consultation: 'استشارة تقنية'
    };

    const templateParams = {
        from_name: formData.name,
        from_email: formData.email,
        phone: formData.phone || 'غير محدد',
        service: serviceNames[formData.service] || formData.service,
        message: formData.message,
        to_email: 'nkslssk1987@gmail.com'
    };

    // إرسال فوري باستخدام خدمة مجانية
    return fetch('https://api.web3forms.com/submit', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
        },
        body: JSON.stringify({
            access_key: '2a3e3466-5f3d-46ee-8178-23e0a2d6aeb3', // مفتاح مؤقت للاختبار
            name: formData.name,
            email: formData.email,
            phone: formData.phone,
            subject: `رسالة جديدة من ${formData.name} - ${serviceNames[formData.service] || formData.service}`,
            message: `الاسم: ${formData.name}\nالبريد الإلكتروني: ${formData.email}\nرقم الهاتف: ${formData.phone || 'غير محدد'}\nالخدمة المطلوبة: ${serviceNames[formData.service] || formData.service}\n\nرسالة العميل:\n${formData.message}\n\n---\nتم الإرسال عبر موقع CRO الرسمي`,
            to: 'nkslssk1987@gmail.com',
            from: formData.email,
            replyto: formData.email
        })
    });
}

function handleContactForm() {
    const form = document.getElementById('contactForm');
    const statusEl = document.getElementById('formStatus');
    const sendBtn = document.getElementById('sendBtn');

    if (form) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            // إعادة تعيين الحالة
            if (statusEl) {
                statusEl.className = 'form-status';
                statusEl.textContent = '';
                statusEl.classList.remove('show');
            }

            // جمع بيانات النموذج
            const formData = {
                name: document.getElementById('name').value.trim(),
                email: document.getElementById('email').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                service: document.getElementById('service').value,
                message: document.getElementById('message').value.trim()
            };

            // اللغة الحالية
            const lang = getCurrentLang();
            const t = translations[lang] || translations['ar'];

            // تحقق بسيط من الصحة
            if (!formData.name || !formData.email || !formData.service || !formData.message) {
                if (statusEl) {
                    statusEl.textContent = t.requiredFields;
                    statusEl.classList.add('show', 'error');
                }
                return;
            }

            // تحضير حالة الإرسال
            if (sendBtn) {
                sendBtn.disabled = true;
                sendBtn.textContent = t.sendingAuto || '...';
            }

            try {
                // محاولة الإرسال التلقائي أولاً
                const response = await sendEmailDirectly(formData);
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // نجح الإرسال التلقائي
                        if (statusEl) {
                            statusEl.innerHTML = `
                                ✅ <strong>${t.sendSuccessTitle}</strong><br>
                                <small>${t.sendSuccessDesc}</small><br>
                                <small>📞 ${t.quickPhone} <a href="tel:${COMPANY_PHONE_TEL}">${COMPANY_PHONE}</a></small>
                            `;
                            statusEl.classList.add('show', 'success');
                        }
                        form.reset();
                        return;
                    }
                }
                
                // إذا فشل الإرسال التلقائي، استخدم mailto
                throw new Error('Direct send failed');
                
            } catch (err) {
                console.log('فشل الإرسال التلقائي، استخدام mailto كبديل:', err.message);
                
                // استخدام mailto كبديل
                sendViaMailto(formData);
                
                if (statusEl) {
                    statusEl.innerHTML = `
                        ✅ <strong>${t.sendMailtoOpenedTitle}</strong><br>
                        <small><strong>${t.sendMailtoFinalStepTitle}</strong> ${t.sendMailtoFinalStepText}</small><br>
                        <small>💬 ${t.whatsappHint}</small><br>
                        <small>📞 ${t.quickPhone} <a href="tel:${COMPANY_PHONE_TEL}">${COMPANY_PHONE}</a></small>
                    `;
                    statusEl.classList.add('show', 'success');
                }
                form.reset();
            } finally {
                if (sendBtn) {
                    const langFinal = getCurrentLang();
                    const tFinal = translations[langFinal] || translations['ar'];
                    sendBtn.disabled = false;
                    sendBtn.textContent = tFinal.sendBtn || 'Send';
                }
            }
        });
    }
}

// إضافة تأثيرات تفاعلية للبطاقات
function addInteractiveEffects() {
    // تأثير hover للبطاقات
    const cards = document.querySelectorAll('.app-card, .service-item, .update-card');
    cards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
}

// تحسين دالة تبديل اللغة مع حفظ التفضيل
function setLanguage(lang) {
    // 1. تبديل النصوص
    const currentTrans = translations[lang];
    for (const key in currentTrans) {
        const element = document.getElementById(key);
        if (element) {
            // استخدام innerHTML للحفاظ على تنسيق Bold في بعض النصوص
            element.innerHTML = currentTrans[key]; 
        }
    }

    // 2. تبديل placeholders للحقول
    const placeholderElements = document.querySelectorAll('[data-placeholder-key]');
    placeholderElements.forEach(element => {
        const placeholderKey = element.getAttribute('data-placeholder-key');
        if (currentTrans[placeholderKey]) {
            element.setAttribute('placeholder', currentTrans[placeholderKey]);
        }
    });

    // 3. تبديل الاتجاه (Direction) والـ lang attribute
    const htmlElement = document.documentElement;
    if (lang === 'ar') {
        htmlElement.setAttribute('lang', 'ar');
        htmlElement.setAttribute('dir', 'rtl');
    } else {
        htmlElement.setAttribute('lang', 'en');
        htmlElement.setAttribute('dir', 'ltr');
    }

    // 4. تبديل حالة الأزرار
    document.getElementById('langAr').classList.remove('active');
    document.getElementById('langEn').classList.remove('active');
    document.getElementById('lang' + (lang === 'ar' ? 'Ar' : 'En')).classList.add('active');
    
    // 5. حفظ تفضيل اللغة
    localStorage.setItem('preferredLanguage', lang);
}

// إدارة الثيم (الوضع الفاتح/الداكن)
class ThemeManager {
    constructor() {
        this.mode = 'auto'; // 'light' | 'dark' | 'auto'
        this.currentTheme = 'light';
        this.themeToggle = null;
        this.systemListener = null;
        this.init();
    }

    getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    computeEffectiveTheme(mode) {
        if (mode === 'auto') return this.getSystemTheme();
        return mode;
    }

    init() {
        // قراءة الوضع المحفوظ ('auto' الافتراضي)
        const savedMode = localStorage.getItem('themeMode') || 'auto';
        this.mode = savedMode;
        const effective = this.computeEffectiveTheme(this.mode);
        this.applyTheme(effective, false);
        this.updateModeAttributes();

        // زر التبديل
        this.themeToggle = document.getElementById('themeToggle');
        if (this.themeToggle) {
            this.themeToggle.addEventListener('click', () => this.cycleMode());
        }

        // مراقبة تغيّر نظام التشغيل عند الوضع التلقائي
        const mql = window.matchMedia('(prefers-color-scheme: dark)');
        this.systemListener = (e) => {
            if (this.mode === 'auto') {
                const eff = this.computeEffectiveTheme('auto');
                this.applyTheme(eff, false);
            }
        };
        mql.addEventListener('change', this.systemListener);

        // تحديث عنوان الزر
        this.updateToggleTitle();
    }

    cycleMode() {
        const order = ['light', 'dark', 'auto'];
        const idx = order.indexOf(this.mode);
        const next = order[(idx + 1) % order.length];
        this.setMode(next);
    }

    setMode(mode) {
        this.mode = mode;
        localStorage.setItem('themeMode', mode);
        const eff = this.computeEffectiveTheme(mode);
        this.applyTheme(eff, true);
        this.updateModeAttributes();
        this.updateToggleTitle();
    }

    updateModeAttributes() {
        const html = document.documentElement;
        html.setAttribute('data-theme-mode', this.mode);
        // aria-pressed تعكس إن كان الوضع النهائي داكن
        if (this.themeToggle) {
            this.themeToggle.setAttribute('aria-pressed', this.currentTheme === 'dark');
        }
    }

    updateToggleTitle() {
        if (!this.themeToggle) return;
        const titles = {
            light: 'الوضع الحالي: فاتح (انقر للتبديل إلى داكن)',
            dark: 'الوضع الحالي: داكن (انقر للتبديل إلى تلقائي)',
            auto: 'الوضع الحالي: تلقائي (انقر للتبديل إلى فاتح)'
        };
        this.themeToggle.setAttribute('title', titles[this.mode] || 'تبديل الوضع');
    }

    applyTheme(theme, withTransition = true) {
        this.currentTheme = theme;
        const html = document.documentElement;
        
        // تفعيل انتقال ناعم لفترة قصيرة
        if (withTransition) {
            html.classList.add('theme-transition');
            setTimeout(() => html.classList.remove('theme-transition'), 250);
        }
        
        // تطبيق الثيم
        html.setAttribute('data-theme', theme);
        
        // حفظ الثيم الفعلي للتوافق الرجعي
        localStorage.setItem('theme', theme);
        
        // تحديث attributes للمعلومات الإضافية
        this.updateModeAttributes();
        
        // إضافة تأثير ريبل على زر الثيم (تأثير بصري)
        if (withTransition && this.themeToggle) {
            // تأثير الضغط
            this.themeToggle.style.transform = 'scale(0.9)';
            this.themeToggle.style.opacity = '0.7';
            
            // إضافة فئة تحميل مؤقتة
            this.themeToggle.classList.add('theme-switching');
            
            setTimeout(() => {
                this.themeToggle.style.transform = '';
                this.themeToggle.style.opacity = '';
                this.themeToggle.classList.remove('theme-switching');
            }, 200);
        }
        
        // بث حدث تغيير الثيم
        document.dispatchEvent(new CustomEvent('themeChanged', { 
            detail: { 
                theme, 
                mode: this.mode, 
                isSystemMode: this.mode === 'auto',
                systemTheme: this.getSystemTheme()
            } 
        }));
        
        // لوغ تفصيلي لاستكشاف الأخطاء
        console.log(`🎨 Theme System: Applied "${theme}" (Mode: ${this.mode}, System: ${this.getSystemTheme()})`);
    }

    getCurrentTheme() {
        return this.currentTheme;
    }
}

// إعداد مفاتيح EmailJS - استبدل القيم بين الأقواس المزدوجة بالقيم الحقيقية من حسابك في EmailJS
const EMAILJS_PUBLIC_KEY = '{{EMAILJS_PUBLIC_KEY}}';
const EMAILJS_SERVICE_ID = '{{EMAILJS_SERVICE_ID}}';
const EMAILJS_TEMPLATE_ID = '{{EMAILJS_TEMPLATE_ID}}';
let EMAILJS_READY = false;

function initEmailJS() {
    if (window.emailjs && EMAILJS_PUBLIC_KEY && !EMAILJS_PUBLIC_KEY.includes('{{')) {
        try {
            window.emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
            EMAILJS_READY = true;
            console.log('EmailJS initialized');
        } catch (e) {
            console.warn('EmailJS init failed:', e);
        }
    } else {
        console.warn('EmailJS is not configured. Please set EMAILJS_PUBLIC_KEY, EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID.');
    }
}

// تهيئة الموقع عند التحميل
function initializeWebsite() {
    // تشغيل مكتبة AOS
    AOS.init({
        duration: 800,
        once: true,
        mirror: false,
        offset: 50,
        easing: 'ease-out-cubic'
    });
    
    // تهيئة مدير الثيم
    window.themeManager = new ThemeManager();

    // تهيئة EmailJS
    initEmailJS();
    
    // قراءة اللغة المفضلة من التخزين المحلي
    const savedLanguage = localStorage.getItem('preferredLanguage') || 'ar';
    setLanguage(savedLanguage);

    // تهيئة زر الاتصال المباشر
    setupDirectCallButton();
    
    // تفعيل نموذج الاتصال
    handleContactForm();
    
    // إضافة تأثيرات تفاعلية
    addInteractiveEffects();
    
    // إضافة smooth scroll للروابط
    setupSmoothScroll();
    
    // معالجة تأثيرات التحريك المتقدمة
    setupAdvancedAnimations();
    
    // تهيئة مميزات الفيديو
    initializeVideoFeatures();
    
    // تهيئة تفاعل MyTools
    setupMyToolsNotification();
}

// إعداد smooth scroll محسّن
function setupSmoothScroll() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                const headerHeight = document.querySelector('.main-header')?.offsetHeight || 80;
                const targetPosition = target.offsetTop - headerHeight;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        });
    });
}

// تأثيرات متقدمة
function setupAdvancedAnimations() {
    // تأثير parallax للهيرو
    const hero = document.querySelector('.hero');
    if (hero) {
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const rate = scrolled * -0.5;
            hero.style.transform = `translateY(${rate}px)`;
        });
    }
    
    // تأثير حركة الفأرة للبطاقات
    document.addEventListener('mousemove', (e) => {
        const cards = document.querySelectorAll('.app-card, .service-item');
        cards.forEach(card => {
            if (card.matches(':hover')) {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = (y - centerY) / 10;
                const rotateY = (centerX - x) / 10;
                
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
            }
        });
    });
    
    // إعادة تعيين البطاقات عند مغادرة الفأرة
    document.addEventListener('mouseleave', () => {
        const cards = document.querySelectorAll('.app-card, .service-item');
        cards.forEach(card => {
            card.style.transform = '';
        });
    });
}

// تشغيل الموقع عند التحميل الكامل
window.addEventListener('load', initializeWebsite);


/*
====================================
  تفاعل قسم MyTools القادم
====================================
*/

// إدارة زر الإشعار لـ MyTools
function setupMyToolsNotification() {
    const notifyBtn = document.getElementById('notifyBtn');
    if (!notifyBtn) return;
    
    notifyBtn.addEventListener('click', async function() {
        const btnText = notifyBtn.querySelector('.btn-text');
        const btnIcon = notifyBtn.querySelector('.btn-icon');
        const emailInput = document.getElementById('notifyEmail');
        const statusBox = document.getElementById('notificationStatus');

        const currentLang = getCurrentLang();
        const messages = {
            ar: {
                invalid: 'يرجى إدخال بريد إلكتروني صالح.',
                loading: 'جارٍ التسجيل لإشعار الإطلاق...',
                success: 'تم تسجيل بريدك بنجاح! سنقوم بإشعارك عند الإطلاق.',
                error: 'حدث خطأ أثناء التسجيل. حاول مرة أخرى لاحقاً.',
                notConfigured: 'النظام غير مهيأ للإرسال بعد. يرجى إعداد EmailJS.',
                btnLoading: '...جارٍ التسجيل',
                btnDone: 'تم التسجيل',
                iconLoading: '⏳',
                iconDone: '✅'
            },
            en: {
                invalid: 'Please enter a valid email address.',
                loading: 'Registering for launch notification...',
                success: 'Your email has been registered! We will notify you on launch.',
                error: 'An error occurred during registration. Please try again later.',
                notConfigured: 'Email delivery is not configured yet. Please set up EmailJS.',
                btnLoading: 'Registering...',
                btnDone: 'Registered',
                iconLoading: '⏳',
                iconDone: '✅'
            }
        };
        const msg = messages[currentLang];

        // Validate email
        const email = (emailInput?.value || '').trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            if (emailInput) emailInput.classList.add('error');
            if (statusBox) {
                statusBox.className = 'notification-status show error';
                statusBox.textContent = msg.invalid;
            }
            return;
        }
        if (emailInput) emailInput.classList.remove('error');

        // Loading state
        notifyBtn.classList.add('loading');
        btnIcon.textContent = msg.iconLoading;
        btnText.textContent = msg.btnLoading;
        if (statusBox) {
            statusBox.className = 'notification-status show loading';
            statusBox.textContent = msg.loading;
        }

        // Ensure EmailJS init
        if (!EMAILJS_READY) {
            initEmailJS();
        }

        if (!EMAILJS_READY || EMAILJS_SERVICE_ID.includes('{{') || EMAILJS_TEMPLATE_ID.includes('{{')) {
            // Not configured
            if (statusBox) {
                statusBox.className = 'notification-status show error';
                statusBox.textContent = msg.notConfigured;
            }
            notifyBtn.classList.remove('loading');
            btnIcon.textContent = '⚠️';
            btnText.textContent = msg.notConfigured;
            return;
        }

        try {
            const templateParams = {
                user_email: email,
                app_name: 'MyTools',
                message: 'Notify me when MyTools launches',
                timestamp: new Date().toISOString()
            };
            await window.emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);

            // Success UI
            notifyBtn.classList.remove('loading');
            notifyBtn.classList.add('confirmed');
            btnIcon.textContent = msg.iconDone;
            btnText.textContent = msg.btnDone;
            notifyBtn.disabled = true;
            notifyBtn.style.cursor = 'default';
            if (statusBox) {
                statusBox.className = 'notification-status show success';
                statusBox.textContent = msg.success;
            }
            showNotificationSuccess(msg.success);
        } catch (e) {
            console.error('EmailJS send failed:', e);
            notifyBtn.classList.remove('loading');
            if (statusBox) {
                statusBox.className = 'notification-status show error';
                statusBox.textContent = msg.error;
            }
            btnIcon.textContent = '⚠️';
            btnText.textContent = msg.error;
        }
    });
}

// إظهار رسالة النجاح
function showNotificationSuccess(message) {
    // إنشاء عنصر الرسالة
    const successMsg = document.createElement('div');
    successMsg.className = 'notification-success';
    successMsg.innerHTML = `
        <div class="success-content">
            <span class="success-icon">🎉</span>
            <span class="success-text">${message}</span>
        </div>
    `;
    
    // إضافة أنماط الرسالة
    Object.assign(successMsg.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        background: 'rgba(76, 175, 80, 0.95)',
        color: 'white',
        padding: '15px 20px',
        borderRadius: '10px',
        boxShadow: '0 8px 25px rgba(76, 175, 80, 0.3)',
        zIndex: '9999',
        transform: 'translateX(400px)',
        transition: 'all 0.5s ease',
        backdropFilter: 'blur(10px)',
        maxWidth: '300px',
        fontSize: '0.9rem',
        fontWeight: '500'
    });
    
    // أنماط المحتوى الداخلي
    const successContent = successMsg.querySelector('.success-content');
    Object.assign(successContent.style, {
        display: 'flex',
        alignItems: 'center',
        gap: '10px'
    });
    
    // إضافة الرسالة للصفحة
    document.body.appendChild(successMsg);
    
    // تأثير الظهور
    setTimeout(() => {
        successMsg.style.transform = 'translateX(0)';
    }, 100);
    
    // إزالة الرسالة بعد 4 ثوانٍ
    setTimeout(() => {
        successMsg.style.transform = 'translateX(400px)';
        setTimeout(() => {
            document.body.removeChild(successMsg);
        }, 500);
    }, 4000);
}

// تهيئة تفاعل MyTools عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
    setupMyToolsNotification();
});

// تأكد من إعادة تهيئة التفاعل عند تغيير اللغة
document.addEventListener('languageChanged', function() {
    setupMyToolsNotification();
});


/*
====================================
  مميزات الفيديو والمودال المتقدمة
====================================
*/

// متغيرات عامة للفيديو
let currentVideoData = {
    videoId: '',
    appName: '',
    playStoreLink: ''
};

// إعداد مستمعات الأحداث للتطبيقات
document.addEventListener('DOMContentLoaded', function() {
    initializeVideoFeatures();
});

function initializeVideoFeatures() {
    console.log('بدء تهيئة مميزات الفيديو...');
    
    // إعداد أزرار الفيديو
    const videoButtons = document.querySelectorAll('.video-btn');
    const appCards = document.querySelectorAll('.app-card.premium-app');
    
    console.log('تم العثور على', videoButtons.length, 'أزرار فيديو');
    console.log('تم العثور على', appCards.length, 'بطاقات تطبيقات');
    
    // إضافة مستمعات الأحداث لأزرار الفيديو
    videoButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('تم النقر على زر الفيديو');
            
            const videoId = this.getAttribute('data-video');
            const appCard = this.closest('.app-card');
            const appName = appCard.getAttribute('data-app-name');
            const playStoreLink = appCard.getAttribute('data-play-store');
            
            console.log('معرف الفيديو:', videoId);
            console.log('اسم التطبيق:', appName);
            
            openVideoModal(videoId, appName, playStoreLink);
        });
    });
    
    // إضافة مستمعات الأحداث للصور (تأثير hover)
    appCards.forEach(card => {
        const imageContainer = card.querySelector('.app-image-container');
        const playButton = card.querySelector('.play-button');
        
        if (imageContainer && playButton) {
            imageContainer.addEventListener('click', function() {
                const videoId = card.getAttribute('data-video-id');
                const appName = card.getAttribute('data-app-name');
                const playStoreLink = card.getAttribute('data-play-store');
                
                openVideoModal(videoId, appName, playStoreLink);
            });
            
            // تأثير hover متقدم
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-20px) scale(1.05)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        }
    });
    
    // إعداد مستمعات إغلاق المودال
    const modal = document.getElementById('videoModal');
    const closeBtn = modal?.querySelector('.close-btn');
    const backdrop = modal?.querySelector('.modal-backdrop');
    
    if (closeBtn) {
        closeBtn.addEventListener('click', closeVideoModal);
    }
    
    if (backdrop) {
        backdrop.addEventListener('click', closeVideoModal);
    }
    
    // إغلاق بمفتاح ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal?.classList.contains('active')) {
            closeVideoModal();
        }
    });
}

// فتح مودال الفيديو
function openVideoModal(videoId, appName, playStoreLink) {
    console.log('فتح مودال الفيديو بالمعرف:', videoId);
    
    const modal = document.getElementById('videoModal');
    const modalTitle = document.getElementById('modalTitle');
    const videoFrame = document.getElementById('videoFrame');
    const downloadBtn = document.getElementById('modalDownloadBtn');
    
    console.log('عناصر المودال:', {
        modal: modal ? 'موجود' : 'غير موجود',
        videoFrame: videoFrame ? 'موجود' : 'غير موجود',
        modalTitle: modalTitle ? 'موجود' : 'غير موجود'
    });
    
    if (!modal || !videoFrame) {
        console.error('خطأ: عناصر المودال غير موجودة!');
        return;
    }
    
    // حفظ بيانات التطبيق الحالي
    currentVideoData = {
        videoId: videoId,
        appName: appName,
        playStoreLink: playStoreLink
    };
    
    // تحديث عنوان المودال
    if (modalTitle) {
        modalTitle.textContent = `مراجعة تطبيق ${appName}`;
    }
    
    // تحديث رابط التحميل
    if (downloadBtn) {
        downloadBtn.onclick = function() {
            window.open(playStoreLink, '_blank');
            trackAppDownload(appName);
        };
    }
    
    // تحميل الفيديو من YouTube
    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&showinfo=0&controls=1`;
    videoFrame.src = embedUrl;
    
    // إظهار المودال مع تأثير
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
    
    // تتبع مشاهدة الفيديو (Analytics)
    trackVideoView(appName, videoId);
}

// إغلاق مودال الفيديو
function closeVideoModal() {
    console.log('محاولة إغلاق مودال الفيديو...');
    
    const modal = document.getElementById('videoModal');
    const videoFrame = document.getElementById('videoFrame');
    
    if (!modal) return;
    
    // إخفاء المودال
    modal.classList.remove('active');
    document.body.style.overflow = 'auto';
    
    // إيقاف الفيديو
    if (videoFrame) {
        videoFrame.src = '';
    }
    
    // مسح البيانات
    currentVideoData = {
        videoId: '',
        appName: '',
        playStoreLink: ''
    };
}

// تتبع مشاهدة الفيديو (يمكن ربطه بـ Google Analytics)
function trackVideoView(appName, videoId) {
    // يمكن إضافة كود تتبع هنا
    console.log(`تم فتح فيديو مراجعة: ${appName} - Video ID: ${videoId}`);
    
    // مثال لـ Google Analytics (إذا كان مثبت)
    if (typeof gtag !== 'undefined') {
        gtag('event', 'video_play', {
            'app_name': appName,
            'video_id': videoId,
            'content_type': 'app_review'
        });
    }
}

// تتبع تحميل التطبيق
function trackAppDownload(appName) {
    console.log(`تم النقر على تحميل التطبيق: ${appName}`);
    
    if (typeof gtag !== 'undefined') {
        gtag('event', 'app_download_click', {
            'app_name': appName,
            'source': 'video_modal'
        });
    }
}

// تحسينات اللمس للأجهزة المحمولة
function initializeTouchEnhancements() {
    if ('ontouchstart' in window) {
        const appCards = document.querySelectorAll('.app-card');
        
        appCards.forEach(card => {
            card.addEventListener('touchstart', function() {
                this.classList.add('touch-active');
            });
            
            card.addEventListener('touchend', function() {
                setTimeout(() => {
                    this.classList.remove('touch-active');
                }, 300);
            });
        });
    }
}

// تحسين الأداء للأنيميشن
function optimizeAnimations() {
    // تقليل الحركة إذا كان المستخدم يفضل ذلك
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        const style = document.createElement('style');
        style.textContent = `
            .app-card,
            .play-button,
            .video-overlay,
            .modal-content {
                transition: none !important;
                animation: none !important;
            }
        `;
        document.head.appendChild(style);
    }
}

// تشغيل التحسينات عند التحميل
document.addEventListener('DOMContentLoaded', function() {
    initializeTouchEnhancements();
    optimizeAnimations();
});

// تحسين الأداء مع Intersection Observer للأنيميشن
if ('IntersectionObserver' in window) {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-in');
            }
        });
    }, observerOptions);
    
    // مراقبة بطاقات التطبيقات
    document.addEventListener('DOMContentLoaded', function() {
        const appCards = document.querySelectorAll('.app-card');
        appCards.forEach(card => observer.observe(card));
    });
}

// إضافة تحسينات خاصة للأجهزة المحمولة
function addMobileOptimizations() {
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
        // تبسيط التأثيرات على الجوال
        const appCards = document.querySelectorAll('.app-card');
        appCards.forEach(card => {
            card.addEventListener('touchstart', function() {
                this.style.transform = 'translateY(-10px) scale(1.02)';
            });
            
            card.addEventListener('touchend', function() {
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            });
        });
        
        // تحسين المودال للجوال
        const modal = document.getElementById('videoModal');
        if (modal) {
            modal.addEventListener('touchmove', function(e) {
                e.preventDefault();
            }, { passive: false });
        }
    }
}

// تشغيل التحسينات المحمولة
document.addEventListener('DOMContentLoaded', addMobileOptimizations);
window.addEventListener('resize', addMobileOptimizations);

// إتاحة الدوال عالمياً للاستخدام من HTML
window.openVideoModal = openVideoModal;
window.closeVideoModal = closeVideoModal;
